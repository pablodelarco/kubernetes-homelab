## General settings
nameOverride: "minio"
fullnameOverride: "minio"

## Cluster domain
clusterDomain: cluster.local

## MinIO container image
image:
  repository: quay.io/minio/minio
  tag: RELEASE.2024-12-18T13-15-44Z
  pullPolicy: IfNotPresent

mcImage:
  repository: quay.io/minio/mc
  tag: RELEASE.2024-11-21T17-21-54Z
  pullPolicy: IfNotPresent

## MinIO mode
mode: standalone

## MinIO access credentials
rootUser: ""
rootPassword: ""
existingSecret: minio-login

## Persistence configuration
persistence:
  enabled: true
  storageClass: nfs                 # Use NFS to store data on NAS
  accessMode: ReadWriteMany         # NFS supports RWX
  size: 150Gi                       # Requested storage size
  annotations: {}                   # Optional annotations

## MinIO service configuration
service:
  type: ClusterIP                   # Use ClusterIP with Tailscale Funnel
  port: "9000"                      # MinIO API port
  annotations: {}                   # Optional annotations

consoleService:
  type: ClusterIP                   # Use ClusterIP with Tailscale Funnel
  port: "9001"                      # Console port
  annotations: {}                   # Optional annotations

## Ingress - Disabled, using Cilium Gateway API instead
ingress:
  enabled: false

consoleIngress:
  enabled: false

## Security context
securityContext:
  enabled: true
  runAsUser: 65534
  runAsGroup: 100
  fsGroup: 100
  fsGroupChangePolicy: "OnRootMismatch"

## Metrics and monitoring
metrics:
  serviceMonitor:
    enabled: true
    includeNode: true
    public: true
    # for node metrics
    relabelConfigs: {}
    # for cluster metrics
    relabelConfigsCluster: {}
      # metricRelabelings:
      #   - regex: (server|pod)
      #     action: labeldrop
    namespace: minio
    # Scrape interval, for example `interval: 30s`
    interval: 60s
    # Scrape timeout, for example `scrapeTimeout: 10s`
    scrapeTimeout: 30s
  

resources:
  requests:
    memory: 2Gi
    cpu: 500m
  limits:
    memory: 4Gi
    cpu: 1

# Prefer scheduling on worker node to balance cluster load
affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - worker

## Additional custom commands
customCommands: []

## Environment variables for NFS optimization
environment:
  ## Increase drive health check tolerance for NFS latency
  MINIO_DRIVE_HEALTH_CHECK_INTERVAL: "60s"
  ## Increase timeout for drive operations
  MINIO_DRIVE_HEALTH_CHECK_TIMEOUT: "120s"
  ## Disable O_DIRECT for better NFS compatibility
  MINIO_CI_CD: "on"



