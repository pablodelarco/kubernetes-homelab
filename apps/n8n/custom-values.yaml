# ── 1. Persistent data (unchanged) ────────────────────────────────────────────
persistence:
  enabled: true
  accessMode: ReadWriteOnce
  size: 5Gi
  storageClass: ""
  mountPath: /home/node/.n8n

# ── 2. n8n container & app-level config ──────────────────────────────────────
main:
  # 2-a) Port the container will LISTEN on
  config:
    port: 443                       # ← becomes containerPort
    n8n:
      # Public URLs n8n advertises internally
      # Public URLs n8n advertises internally
      webhookUrl:       "http://n8n.homelab"
      host:             "n8n.homelab"
      protocol:         "http"
      publicApiBaseUrl: "http://n8n.homelab"

  # 2-b) Extra env so n8n process actually binds 443 & HTTPS
  extraEnv:
    N8N_PORT:
      value: "5678"
    N8N_PROTOCOL:
      value: "http"
    N8N_SECURE_COOKIE:
      value: "false"
    # Optimizations/Deprecation Fixes
    DB_SQLITE_POOL_SIZE:
      value: "50"
    N8N_RUNNERS_ENABLED:
      value: "true"
    N8N_GIT_NODE_DISABLE_BARE_REPOS:
      value: "true"

  # 2-c) Security context ⇒ allow binding port <1024
  securityContext:
  # 2-c) Security context ⇒ allow binding port <1024
  securityContext:
    # enabled: true  <-- REMOVED: Causes SyncError (field not declared in schema)
    capabilities:
      add: ["NET_BIND_SERVICE"]
    capabilities:
      add: ["NET_BIND_SERVICE"]

  # 2-d) Kubernetes Service settings
  service:
    type: ClusterIP

# ── 3. Ingress - Disabled, using Cilium Gateway API instead ─────────────────
ingress:
  enabled: false

# ── 4. Node affinity - prefer worker to balance memory across nodes ────────
affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - worker
