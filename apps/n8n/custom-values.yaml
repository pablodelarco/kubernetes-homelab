# ── 1. n8n container & app-level config ──────────────────────────────────────
main:
  # App configuration (becomes ConfigMap env vars)
  config:
    port: 443
    n8n:
      webhookUrl:       "http://n8n.homelab"
      host:             "n8n.homelab"
      protocol:         "http"
      publicApiBaseUrl: "http://n8n.homelab"

  # Secrets (becomes K8s Secret, referenced as env vars)
  secret:
    n8n:
      encryption_key: "Nb+XP252eQXsESLthEb7mWKoyF721sIv"

  # Extra env vars
  extraEnv:
    N8N_PORT:
      value: "5678"
    N8N_PROTOCOL:
      value: "http"
    N8N_SECURE_COOKIE:
      value: "false"
    DB_SQLITE_POOL_SIZE:
      value: "50"
    N8N_RUNNERS_ENABLED:
      value: "true"
    N8N_GIT_NODE_DISABLE_BARE_REPOS:
      value: "true"

  # Persistent storage (under main, not top-level)
  persistence:
    enabled: true
    type: dynamic
    storageClass: "longhorn"
    accessModes:
      - ReadWriteOnce
    size: 5Gi

  # Security context
  securityContext:
    capabilities:
      add: ["NET_BIND_SERVICE"]

  # Kubernetes Service
  service:
    type: ClusterIP

  # Node affinity - prefer worker to balance memory
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          preference:
            matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                  - worker

# ── 2. Ingress - Disabled, using Cilium Gateway API instead ─────────────────
ingress:
  enabled: false
