# Service configuration - LoadBalancer for MetalLB
service:
  enabled: true
  type: LoadBalancer
  annotations: {}
  labels: {}

opencost:
  prometheus:
    internal:
      namespaceName: monitoring
      serviceName: monitoring-kube-prometheus-prometheus
      port: 9090

  dataRetention:
    dailyResolutionDays: 30

  exporter:
    defaultClusterId: homelab-cluster
    replicas: 1
    resources:
      requests:
        cpu: "10m"
        memory: "55Mi"
      limits:
        memory: "1Gi"
    persistence:
      enabled: true
      storageClass: "longhorn"
      accessMode: ReadWriteOnce
      size: 5Gi
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: kubernetes.io/hostname
                  operator: In
                  values:
                    - beelink

  metrics:
    kubeStateMetrics:
      emitKsmV1Metrics: false
      emitKsmV1MetricsOnly: false
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: monitoring

  ui:
    enabled: true

# Ingress for Tailscale Funnel (external access)
ingress:
  enabled: true
  ingressClassName: tailscale
  annotations:
    tailscale.com/funnel: "true"
  rules:
    - host: opencost
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: opencost
                port:
                  number: 9090
  tls:
    - hosts:
        - opencost

