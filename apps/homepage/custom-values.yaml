config:
  bookmarks:
    - Development:
        - GitHub Repo:
            - abbr: GH
              icon: si-github
              href: https://github.com/pablodelarco/kubernetes-homelab
        - Tailscale:
            - abbr: TS
              icon: si-tailscale
              href: https://login.tailscale.com/admin/machines
    - Management:
        - ArgoCD:
            - abbr: AR
              icon: si-argo
              href: http://argocd.homelab/
        - Minio Console:
            - abbr: MC
              icon: minio.png
              href: http://minio-console.homelab/
        - ESPHome:
            - abbr: ES
              icon: esphome.png
              href: http://esphome.homelab/

  services:
    # Column 1: Home
    - Infrastructure:
        - AdGuard Home:
            icon: adguard-home.png
            href: http://adguard.homelab/
            description: DNS & ad blocking
            siteMonitor: http://adguard-home.adguard-home.svc.cluster.local:3000
            widget:
              type: adguard
              url: http://adguard-home.adguard-home.svc.cluster.local:3000
              username: "{{HOMEPAGE_VAR_ADGUARD_USER}}"
              password: "{{HOMEPAGE_VAR_ADGUARD_PASSWORD}}"
        - Uptime Kuma:
            icon: uptime-kuma.png
            href: http://uptime.homelab/
            description: Systems monitoring
            siteMonitor: http://uptime-kuma.uptime-kuma.svc.cluster.local:3001
            widget:
              type: uptimekuma
              url: http://uptime-kuma.uptime-kuma.svc.cluster.local:3001
              slug: homelab
              key: "{{HOMEPAGE_VAR_UPTIMEKUMA_API_KEY}}"
        - Synology NAS:
            icon: synology-dsm.png
            href: http://192.168.1.42:5000/
            description: NAS storage
            siteMonitor: http://192.168.1.42:5000
            widget:
              type: diskstation
              url: http://192.168.1.42:5000
              username: "{{HOMEPAGE_VAR_SYNOLOGY_USER}}"
              password: "{{HOMEPAGE_VAR_SYNOLOGY_PASSWORD}}"
        - Speedtest Tracker:
            icon: speedtest-tracker.png
            href: http://speedtest.homelab/
            description: Internet speed monitoring
            siteMonitor: http://speedtest-tracker.speedtest-tracker.svc.cluster.local
            widget:
              type: speedtest
              url: http://speedtest-tracker.speedtest-tracker.svc.cluster.local
    # Column 2: Media
    - Media Processing:
        - qBittorrent:
            icon: qbittorrent.png
            href: http://qbitt.homelab/
            description: Torrent client
            siteMonitor: http://qbitt.media.svc.cluster.local
            widget:
              type: qbittorrent
              url: http://qbitt.media.svc.cluster.local
              username: "{{HOMEPAGE_VAR_QBITTORRENT_USER}}"
              password: "{{HOMEPAGE_VAR_QBITTORRENT_PASSWORD}}"
        - Radarr:
            icon: radarr.png
            href: http://radarr.homelab/
            description: Movies automation
            siteMonitor: http://radarr.media.svc.cluster.local

    # Column 3: Monitoring & Infra (no header)
    - Monitoring:
        - Grafana:
            icon: grafana.png
            href: http://grafana.homelab/
            description: Dashboards
            siteMonitor: http://monitoring-grafana.monitoring.svc.cluster.local
        - Longhorn:
            icon: longhorn.png
            href: http://longhorn.homelab/
            description: Block storage
            siteMonitor: http://longhorn-frontend.longhorn-system.svc.cluster.local

    # Column 4: Storage
    - NAS Storage:
        - Home Assistant:
            icon: home-assistant.png
            href: http://ha.homelab/
            description: Home automation
            siteMonitor: http://home-assistant.home-assistant.svc.cluster.local
        - Jellyfin:
            icon: jellyfin.png
            href: http://jellyfin.homelab/
            description: Media streaming
            siteMonitor: http://jellyfin.media.svc.cluster.local:8096

    # Horizontal row: Beelink (Control Plane)
    - Beelink (Control Plane):
        - CPU Monitor:
            widget:
              type: glances
              url: http://192.168.1.106:61208
              version: 4
              metric: cpu
        - Memory Status:
            widget:
              type: glances
              url: http://192.168.1.106:61208
              version: 4
              metric: memory

    # Horizontal row: Worker Node
    - Worker Node:
        - CPU Monitor:
            widget:
              type: glances
              url: http://192.168.1.57:61208
              version: 4
              metric: cpu
        - Memory Status:
            widget:
              type: glances
              url: http://192.168.1.57:61208
              version: 4
              metric: memory

  widgets:
    - logo:
        icon: https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/png/kubernetes.png
    - greeting:
        text_size: xl
        text: "Pablo's Homelab"
    - datetime:
        text_size: l
        format:
          dateStyle: long
          timeStyle: short
          hour12: false
    - openmeteo:
        label: Valencia
        latitude: 39.4699
        longitude: -0.3763
        units: metric
        cache: 5
    - kubernetes:
        cluster:
          show: true
          cpu: true
          memory: true
          showLabel: true
          label: "Cluster"
        nodes:
          show: true
          cpu: true
          memory: true
          showLabel: true

  # Kubernetes integration settings
  kubernetes:
    mode: cluster

  # General settings
  settings:
    title: "Pablo's Homelab"
    favicon: https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/png/kubernetes.png
    theme: dark
    color: slate
    headerStyle: boxed
    hideVersion: true
    cardBlur: md
    statusStyle: dot
    disableCollapse: true
    layout:
      - Infrastructure:
          style: column
          header: true
      - Media Processing:
          style: column
          header: true
      - Monitoring:
          style: column
          header: true
      - NAS Storage:
          style: column
          header: true
      - Development:
          style: column
          header: true
      - Management:
          style: column
          header: true
      - Beelink (Control Plane):
          style: row
          columns: 2
          header: true
      - Worker Node:
          style: row
          columns: 2
          header: true

# Environment variables
env:
  # Required for v1.2.0+ - allow requests from these hosts
  HOMEPAGE_ALLOWED_HOSTS: "homepage.homelab,home.homelab,localhost,127.0.0.1"

# Environment variables loaded from Secret (created manually, not in Git)
# Create the secret with: kubectl apply -f homepage-secrets.yaml (keep this file local only!)
envFrom:
  - secretRef:
      name: homepage-secrets

# The service account is necessary to allow discovery of other services
serviceAccount:
  create: true
  name: homepage

# This enables the service account to access the necessary resources
enableRbac: true

ingress:
  main:
    # Disabled - using Cilium Gateway API instead
    enabled: false

persistence:
  logs:
    enabled: true
    type: pvc
    existingClaim: homepage # Use manual PVC -> creates volume 'pvc-homepage'
    mountPath: /app/config/logs

controller:
  annotations:
    configmap-checksum: '{{ include (print $.Template.BasePath "/configmap.yaml") . | sha256sum }}'

# Prefer scheduling on worker node to balance cluster load
affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - worker
