# Cilium Helm Values for LAN-based Homelab with Native Routing + Gateway API
# Migrated from VXLAN overlay to native routing for better performance

# Cluster configuration
cluster:
  name: default

# CNI configuration
cni:
  binPath: /opt/cni/bin

# IPAM configuration
ipam:
  mode: kubernetes

# IPv4 native routing CIDR (pod network)
ipv4NativeRoutingCIDR: 10.42.0.0/16

# Kubernetes API server (LAN IP)
k8sServiceHost: 192.168.1.106
k8sServicePort: 6443

# Kube-proxy replacement
kubeProxyReplacement: true

# ============================================
# GATEWAY API CONFIGURATION
# ============================================
# Enable Cilium Gateway API with host network mode
# This exposes the gateway directly on node IPs (no LoadBalancer needed)
gatewayAPI:
  enabled: true
  hostNetwork:
    enabled: true

# L7 proxy (required for Gateway API)
l7Proxy: true

# Envoy configuration for Gateway API
envoy:
  enabled: true
  securityContext:
    capabilities:
      keepCapNetBindService: true
      envoy:
        - NET_BIND_SERVICE
        - NET_ADMIN
        - BPF

# Node port configuration
nodePort:
  enabled: true

# External IPs
externalIPs:
  enabled: true

# Host services
hostServices:
  enabled: true

# Operator configuration
operator:
  replicas: 1

# Hubble (observability)
hubble:
  relay:
    enabled: true
  ui:
    enabled: true

# IP masquerading
ipMasqAgent:
  enabled: false

bpf:
  masquerade: true

# ============================================
# NATIVE ROUTING CONFIGURATION
# ============================================
# Since all nodes are on the same LAN (192.168.1.x), we use native routing
# This is faster than VXLAN as there's no encapsulation overhead

# Routing mode: native (direct routing between nodes)
routingMode: native

# Auto-direct node routes: ENABLED
# Nodes are on the same L2 network, so direct routes work
autoDirectNodeRoutes: true

# Enable IPv4 masquerade for external traffic
enableIPv4Masquerade: true

# ============================================
# NOTES:
# ============================================
# - Native routing: No VXLAN overhead, direct pod-to-pod communication
# - Gateway API: Replaces Traefik/Tailscale ingress with Cilium native ingress
# - Host Network Mode: Gateway exposed on node IPs (192.168.1.106/192.168.1.57)
# - Apply: helm upgrade cilium cilium/cilium -n kube-system -f cilium-values-vxlan.yaml
# - After applying, install Gateway API CRDs and create Gateway/HTTPRoute resources
